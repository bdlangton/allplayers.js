var NO_JQUERY={};
(function(b,l,k){if(!("console"in b)){var a=b.console={};a.log=a.warn=a.error=a.debug=function(){}}l===NO_JQUERY&&(l={fn:{},extend:function(){for(var d=arguments[0],q=1,e=arguments.length;q<e;q++){var a=arguments[q],f;for(f in a)d[f]=a[f]}return d}});l.fn.pm=function(){console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};l.pm=b.pm=function(d){c.send(d)};l.pm.bind=b.pm.bind=function(d,q,e,a,f){c.bind(d,q,e,a,!0===f)};l.pm.unbind=b.pm.unbind=function(d,
q){c.unbind(d,q)};l.pm.origin=b.pm.origin=null;l.pm.poll=b.pm.poll=200;var c={send:function(d){d=l.extend({},c.defaults,d);var q=d.target;if(d.target)if(d.type){var e={data:d.data,type:d.type};d.success&&(e.callback=c._callback(d.success));d.error&&(e.errback=c._callback(d.error));"postMessage"in q&&!d.hash?(c._bind(),q.postMessage(JSON.stringify(e),d.origin||"*")):(c.hash._bind(),c.hash.send(d,e))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(d,q,e,a,f){c._replyBind(d,q,e,a,f)},_replyBind:function(d,q,a,g,f){"postMessage"in b&&!g?c._bind():c.hash._bind();g=c.data("listeners.postmessage");g||(g={},c.data("listeners.postmessage",g));var m=g[d];m||(m=[],g[d]=m);m.push({fn:q,callback:f,origin:a||l.pm.origin})},unbind:function(d,a){var e=c.data("listeners.postmessage");if(e)if(d)if(a){var b=e[d];if(b){for(var f=[],m=0,r=b.length;m<r;m++){var n=b[m];n.fn!==a&&f.push(n)}e[d]=f}}else delete e[d];else for(m in e)delete e[m]},data:function(d,
a){return a===k?c._data[d]:c._data[d]=a},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var d=[],a=0;32>a;a++)d[a]=c._CHARS[0|32*Math.random()];return d.join("")},_callback:function(d){var a=c.data("callbacks.postmessage");a||(a={},c.data("callbacks.postmessage",a));var e=c._random();a[e]=d;return e},_bind:function(){c.data("listening.postmessage")||(b.addEventListener?b.addEventListener("message",c._dispatch,!1):b.attachEvent&&b.attachEvent("onmessage",
c._dispatch),c.data("listening.postmessage",1))},_dispatch:function(d){try{var a=JSON.parse(d.data)}catch(e){console.warn("postmessage data invalid json: ",e);return}if(a.type){var b=(c.data("callbacks.postmessage")||{})[a.type];if(b)b(a.data);else for(var b=(c.data("listeners.postmessage")||{})[a.type]||[],f=0,m=b.length;f<m;f++){var r=b[f];if(r.origin&&"*"!==r.origin&&d.origin!==r.origin)console.warn("postmessage message origin mismatch",d.origin,r.origin),a.errback&&c.send({target:d.source,data:{message:"postmessage origin mismatch",
origin:[d.origin,r.origin]},type:a.errback});else{var n=function(f){a.callback&&c.send({target:d.source,data:f,type:a.callback})};try{r.callback?r.fn(a.data,n,d):n(r.fn(a.data,d))}catch(p){if(a.errback)c.send({target:d.source,data:p,type:a.errback});else throw p;}}}}else console.warn("postmessage message type required")},hash:{send:function(d,a){var e=d.target,g=d.url;if(g){var g=c.hash._url(g),f,m=c.hash._url(b.location.href);if(b==e.parent)f="parent";else try{for(var r=0,n=parent.frames.length;r<
n;r++)if(parent.frames[r]==b){f=r;break}}catch(p){f=b.name}null==f?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(f={"x-requested-with":"postmessage",source:{name:f,url:m},postmessage:a},m="#x-postmessage-id="+c._random(),e.location=g+m+encodeURIComponent(JSON.stringify(f)))}else console.warn("postmessage target window url is required")},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:50,_bind:function(){c.data("polling.postmessage")||
(setInterval(function(){var d=""+b.location.hash,a=c.hash._regex.exec(d);a&&(a=a[1],c.hash._last!==a&&(c.hash._last=a,c.hash._dispatch(d.substring(c.hash._regex_len))))},l.pm.poll||200),c.data("polling.postmessage",1))},_dispatch:function(a){if(a){try{if(a=JSON.parse(decodeURIComponent(a)),!("postmessage"===a["x-requested-with"]&&a.source&&null!=a.source.name&&a.source.url&&a.postmessage))return}catch(q){return}var e=a.postmessage,g=(c.data("callbacks.postmessage")||{})[e.type];if(g)g(e.data);else{var f;
f="parent"===a.source.name?b.parent:b.frames[a.source.name];for(var g=(c.data("listeners.postmessage")||{})[e.type]||[],m=0,r=g.length;m<r;m++){var n=g[m];if(n.origin){var p=/https?\:\/\/[^\/]*/.exec(a.source.url)[0];if("*"!==n.origin&&p!==n.origin){console.warn("postmessage message origin mismatch",p,n.origin);e.errback&&c.send({target:f,data:{message:"postmessage origin mismatch",origin:[p,n.origin]},type:e.errback,hash:!0,url:a.source.url});continue}}p=function(b){e.callback&&c.send({target:f,
data:b,type:e.callback,hash:!0,url:a.source.url})};try{n.callback?n.fn(e.data,p):p(n.fn(e.data))}catch(k){if(e.errback)c.send({target:f,data:k,type:e.errback,hash:!0,url:a.source.url});else throw k;}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}}};l.extend(c,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function b(a){return 10>a?"0"+a:a}function l(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var d=e[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function k(a,e){var b,c,p,t,u=d,s,h=e[a];h&&"object"===typeof h&&"function"===typeof h.toJSON&&(h=h.toJSON(a));"function"===typeof g&&(h=g.call(e,a,h));switch(typeof h){case "string":return l(h);case "number":return isFinite(h)?String(h):"null";case "boolean":case "null":return String(h);
case "object":if(!h)return"null";d+=q;s=[];if("[object Array]"===Object.prototype.toString.apply(h)){t=h.length;for(b=0;b<t;b+=1)s[b]=k(b,h)||"null";p=0===s.length?"[]":d?"[\n"+d+s.join(",\n"+d)+"\n"+u+"]":"["+s.join(",")+"]";d=u;return p}if(g&&"object"===typeof g)for(t=g.length,b=0;b<t;b+=1)c=g[b],"string"===typeof c&&(p=k(c,h))&&s.push(l(c)+(d?": ":":")+p);else for(c in h)Object.hasOwnProperty.call(h,c)&&(p=k(c,h))&&s.push(l(c)+(d?": ":":")+p);p=0===s.length?"{}":d?"{\n"+d+s.join(",\n"+d)+"\n"+
u+"}":"{"+s.join(",")+"}";d=u;return p}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,q,e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,e){var c;q=d="";if("number"===typeof e)for(c=0;c<e;c+=1)q+=" ";else"string"===typeof e&&(q=e);if((g=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return k("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(d,b){function e(a,d){var c,s,h=a[d];if(h&&"object"===typeof h)for(c in h)Object.hasOwnProperty.call(h,c)&&(s=e(h,c),void 0!==s?h[c]=s:delete h[c]);return b.call(a,d,h)}var c;a.lastIndex=0;a.test(d)&&(d=d.replace(a,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(d.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return c=eval("("+d+")"),"function"===typeof b?e({"":c},""):c;throw new SyntaxError("JSON.parse");})})();var allplayers=allplayers||{};allplayers.app=function(b,l){if(l){b=b||{};for(var k in l)b.hasOwnProperty(k)||(b[k]=l[k]);this.options=b;this.init()}};allplayers.app.getParam=function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=RegExp("[\\?&]"+b+"=([^&#]*)").exec(window.location.search);return null==b?"":decodeURIComponent(b[1].replace(/\+/g," "))};
allplayers.app.prototype.init=function(){document.proxy=this};allplayers=allplayers||{app:{}};
(function(b,l,k,a,c){a&&!a.fn.allplayers_server&&(a.fn.allplayers_server=function(d){return a(this).each(function(){new k.app.server(d,a(this))})});k.app.server=function(a,c){this.context=c;k.app.call(this,a,{spinner:"",loading:"Loading",base:"https://platform.allplayers.com",type:"registration",group:"api",query:{},reg:{},checkout:{},src:"",style:"",complete:function(){}})};k.app.server.prototype=new k.app;k.app.server.prototype.constructor=k.app.server;k.app.server.prototype.init=function(){k.app.prototype.init.call(this);
this.baseURL="https://platform.allplayers.com";this.options.base&&(this.baseURL=this.options.base);this.isLoading=!0;this.options.spinner||(this.options.spinner=this.options.base,this.options.spinner+="/sites/all/themes/basic_foundation",this.options.spinner+="/images/loader.gif");this.pluginReady=!1;var d=a(l.createElement("div")).css({background:"url("+this.options.spinner+") no-repeat 10px 13px",padding:"10px 10px 10px 60px",width:"100%"});d.append(this.options.loading);var c=this.context.attr("id")+
"_iframe",b="";if(b=k.app.getParam("apq"))b=this.options.base+"/"+b;else if(this.options.src)b=this.options.src;else{b=this.options.base+"/g/"+this.options.group;switch(this.options.type){case "registration":b+="/register";break;case "forms":b+="/forms"}this.options.query.etyp=this.options.type}b+=-1===b.search(/\?/)?"?":"&";if(!function(a){for(var b in a)return!1;return!0}(this.options.query))for(var g in this.options.query)b+=g+"="+encodeURIComponent(this.options.query[g]),b+="&";var b=b+("#"+c),
f=this,m=a(l.createElement("iframe")).attr({id:c,name:c,scrolling:"no",seamless:"seamless",width:"100%",height:"0px",src:b}).css({border:"none",overflowY:"hidden"});this.context.append(d);this.context.append(m);this.serverTarget=null;a.pm.bind("chromePluginReady",function(){f.pluginReady=!0});a.pm.bind("chromeMsgResp",function(s){a.pm({target:f.serverTarget,url:f.baseURL,type:"chromeMsgResp",data:s})});a.pm.bind("chromeMsg",function(s){a.pm({target:f.serverTarget,url:f.baseURL,type:"chromeMsg",data:s})});
a.pm.bind("init",function(a,b){f.serverTarget=b.source;f.isLoading=!1;d.remove();m.height(a.height).attr("height",a.height+"px");return a});var r=function(a){return a.product_uuid&&a.price&&a.quantity&&a.title},n=function(s){return a('input[product="'+s+'"]')},p=function(a){a.price_raw||(a.price_raw=100*accounting.unformat(a.price));a.price=accounting.formatMoney(a.price);a.total=accounting.formatMoney(a.price_raw*a.quantity/100);return a},t=function(a,b){var d=!0;if(a){a=JSON.parse(a);for(var c=
0;c<a.length;c++)if(a[c].title==b.title&&a[c].price_raw==b.price_raw){d=!1;a[c].quantity+=b.quantity;a[c].total=accounting.formatMoney(a[c].price_raw*a[c].quantity/100);b=a[c];break}}else a=[];d&&a.push(b);u(b);return a};k.app.server.prototype.init.processCheckout=function(b,d,c,e){e=b.commerce_order_total.und[0].amount;for(var g=0;g<d.length;g++)e+=d[g].price_raw;for(g=0;g<c.length;g++)e+=c[g].price_raw;a.pm({target:f.serverTarget,url:f.baseURL,type:"processCheckout",data:{checkout:b,adhocProducts:d,
existingProducts:c,orderTotal:e}})};var u=function(b){var d=!0;b.product_uuid?0<a("tr#adhoc-product-"+b.product_uuid).length&&(a("tr#adhoc-product-"+b.product_uuid+" .quantity").text(b.quantity),a("tr#adhoc-product-"+b.product_uuid+" .total").text(b.total),d=!1):a(".views-table tbody tr").each(function(){var c=a(this).find(".title").text(),e=a(this).find(".price").text();if(c&&e&&-1!==c.indexOf(b.title)&&-1!==e.indexOf(b.price))return a(this).find(".quantity").text(b.quantity),a(this).find(".total").text(b.total),
d=!1});d&&a(".views-table tbody").append('<tr id="adhoc-product-'+b.product_uuid+'"><td class="title">'+b.title+'</td><td class="seller"></td><td class="price">'+b.price+'</td><td class="quantity">'+b.quantity+'</td><td class="total">'+b.total+"</td></tr>");var c=a("td.component-total").text(),c=accounting.unformat(c)+b.price_raw/100,c=accounting.formatMoney(c);a("td.component-total").text(c)};a.pm.bind("addProduct",function(b){(new k.product({uuid:b.product_uuid})).getProduct(b.product_uuid,function(c){if(c.uuid==
b.product_uuid){var d=b.product_uuid,e=n(d).val();if(e)e=JSON.parse(e),e.quantity=parseInt(e.quantity),e.quantity+=parseInt(b.quantity),n(d).val(JSON.stringify(e)),a("#add-product-display-"+d+" td:last").text(e.quantity);else if(r(b)){if("undefined"==b.price||"product"==c.type&&0<c.price_raw)b.price=c.price_raw/100;b.title=c.title;b=p(b);a("<input>").attr({type:"hidden",product:d,name:"add-product[]",value:JSON.stringify(b)}).appendTo("form#og-registration-register-app");a("#edit-next").val("Continue");
0==a("#add-products-table").length&&(a("<table>").attr({id:"add-products-table","class":"sticky-table"}).appendTo("#add-products"),a("#add-products-table").append("<thead><tr><th>Added Products</th><th>Price</th><th>Quantity</th></tr></thead><tbody></tbody>"));a("#add-products-table tbody").append('<tr id="add-product-display-'+d+'"><td>'+b.title+"</td><td>"+b.price+"</td><td>"+b.quantity+"</td></tr>")}}else alert("There was an error adding the product.")})});a.pm.bind("addCheckoutProduct",function(b){if(b&&
b.product_uuid)(new k.product({uuid:b.product_uuid})).getProduct(b.product_uuid,function(c){if(c&&c.uuid==b.product_uuid){var d=b.product_uuid,e=n(d).val(),f=a("#add-existing-products-"+b.order_id).val();if(e)e=JSON.parse(e),e.quantity=parseInt(e.quantity),e.quantity+=parseInt(b.quantity),n(d).val(JSON.stringify(e)),a("#adhoc-product-"+d+" td.quantity").text(e.quantity);else if(r(b)){if("undefined"==b.price||"product"==c.type&&0<c.price_raw)b.price=c.price_raw/100,b.price_raw=c.price_raw;b.title=
c.title;b=p(b)}f=t(f,b);a("#add-existing-products-"+b.order_id).val(JSON.stringify(f))}else alert("There was an error adding the product.")});else{b=p(b);b.title+=" (Adhoc)";var c=a("#add-adhoc-products-"+b.order_id).val(),c=t(c,b);a("#add-adhoc-products-"+b.order_id).val(JSON.stringify(c))}});a.pm.bind("removeProduct",function(b){b=b.product_uuid;n(b).val()&&(n(b).remove(),a("#add-product-display-"+b).remove())});a.pm.bind("clientReady",function(b,c){f.serverTarget=c.source;f.pluginReady&&a.pm({target:c.source,
url:f.baseURL,type:"chromePluginReady"});"registration"==f.options.type?a.pm({target:c.source,url:f.baseURL,type:"getRegistration",data:f.options.reg}):"checkout"==f.options.type&&a.pm({target:c.source,url:f.baseURL,type:"getCheckout",data:f.options.checkout})})}})(window,document,window.allplayers,jQuery);
